tParameter(i,`ssat=${encodeURIComponent(f)}`));let e=undefined;return n.config.msbEnableProactiveSearchTransfers&&(e=n.cleanGuid(n.Host.createGuid()),i=this.insertParameter(i,`lgid=${encodeURIComponent(e)}`)),i=this.addMsbCodeParameterToUrl(i),i=this.addTransferIgToUrl(i),h&&(i=this.appendHash(i,h)),{url:i,urlParams:{cvid:l,msbd:u,ssat:f,lgid:e}}}async buildMsbWorkSearchUrlAsync(t,i,r){let u=n.formatString(t.bfbSearchUrl||"",[i,"",r]);return u=await this.addMsbUserInfoParameterToUrlAsync(u),this.addConversationIdToUrl(u)}mapGccRegionToMsbApiEnv(n){return n==1?"prod_gcc":n==2?"prod_gcch":undefined}addMsbCodeParameterToUrl(t){if(n.config.msbEnableProactiveSearchTransfers)t=this.insertParameter(t,`msb=${"bfbwsbpsttf"}`);return t}async addMsbUserInfoParameterToUrlAsync(t){if(!t||typeof crypto!="object")return _w.bfbWsbTel&&bfbWsbTel.logError("Wsb add user info to URL error",`No "window.crypto" object`),t;const i=n.msbHost.getAadUserInfo();if(!(i===null||i===void 0?void 0:i.tenantId)||!(i===null||i===void 0?void 0:i.userAadId))return _w.bfbWsbTel&&bfbWsbTel.logError("Wsb add user info to URL error",`No user info.`),t;const u=this.getSecureSalt();if(!u)return t;try{const r=`${i===null||i===void 0?void 0:i.userAadId.toLowerCase()}@${i===null||i===void 0?void 0:i.tenantId.toLowerCase()}@${u.toLowerCase()}`,f=Uint8Array.from(r.split("").map(n=>n.charCodeAt(0))),e=await crypto.subtle.digest("SHA-256",f),o=new Uint8Array(e);let n="";for(const t of o)n+=t.toString(16).padStart(2,"0");const s=`olu=${n}&olus=${u}`;return this.insertParameter(t,s)}catch(r){return _w.bfbWsbTel&&bfbWsbTel.logError("Wsb add user info to URL error",`Exception: ${(r===null||r===void 0?void 0:r.message)||JSON.stringify(r)}`),t}}async launchUriAsync(t){return await n.Host.launchUriAsync(t)}addConversationIdToUrl(n){if(!n)return n;const t=(_G===null||_G===void 0?void 0:_G.IG)?`cvid=${encodeURIComponent(_G.IG)}`:undefined;return t?this.insertParameter(n,t):n}getSecureSalt(){try{const n=new Uint8Array(16);return _w.crypto.getRandomValues(n),Array.from(n).map(n=>n.toString(16).padStart(2,"0")).join("")}catch(n){return _w.bfbWsbTel&&bfbWsbTel.logError("Wsb add user info to URL error",`Generate salt throws: ${(n===null||n===void 0?void 0:n.message)||JSON.stringify(n)}`),""}}addTransferIgToUrl(n){return n?this.insertParameter(n,`ig=${encodeURIComponent(this.transferIg)}`):n}getT